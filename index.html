<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Demir Kırtasiye — Fiyatlandırma Hesaplayıcı v3</title>
<style>
  :root{
    --dk-blue:#2C2E8E;
    --dk-blue-d:#1f2380;
    --dk-red:#E11F2A;
    --ink:#0b1220;
    --muted:#64748b;
    --bg:#f6f8fb;
    --card:#ffffff;
    --ok:#16a34a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:980px;margin:auto;padding:20px}
  .hero{
    background:linear-gradient(135deg,var(--dk-blue),var(--dk-blue-d));
    color:#fff;border-radius:18px;padding:14px 16px;display:flex;align-items:center;gap:14px;flex-wrap:wrap
  }
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{width:140px;height:auto;display:block;object-fit:contain;background:#fff;border-radius:12px;padding:6px;filter:drop-shadow(0 2px 6px rgba(0,0,0,.15))}
  .hero h1{font-size:22px;font-weight:900;line-height:1.2;margin:0}
  .hero .sub{font-size:13px;opacity:.95}
  .card{background:var(--card);border-radius:18px;box-shadow:0 8px 24px rgba(15,23,42,.06);padding:16px;margin-top:14px}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){ .grid{grid-template-columns:repeat(2,1fr)} }
  .field{display:flex;flex-direction:column;gap:6px}
  label{font-size:13px;color:#111827;font-weight:800;letter-spacing:.1px;display:flex;align-items:center;gap:6px}
  input{
    width:100%;font-size:18px;padding:14px 16px;border:2px solid #e5e7eb;border-radius:14px;background:#fff;
    outline:none;transition:.15s;
  }
  input:focus{border-color:var(--dk-blue);box-shadow:0 0 0 4px rgba(44,46,142,.15)}
  .row-3{display:grid;gap:12px}
  @media(min-width:720px){ .row-3{grid-template-columns:repeat(3,1fr)} }
  .pillbar{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
  .pill{
    flex:1 0 90px;text-align:center;padding:12px 14px;border-radius:14px;font-weight:900;font-size:16px;
    background:var(--dk-blue);color:#fff;border:none;cursor:pointer;box-shadow:0 6px 14px rgba(44,46,142,.25);
    transition:transform .06s ease,filter .06s ease,opacity .15s ease;
  }
  .pill.alt{background:var(--dk-red);box-shadow:0 6px 14px rgba(225,31,42,.25)}
  .pill.active{outline:3px solid rgba(255,255,255,.6)}
  .pill:active{transform:translateY(1px);filter:saturate(1.15)}
  .hint{font-size:13px;color:var(--muted);font-weight:600}
  .result{
    display:flex;flex-direction:column;gap:8px;align-items:center;justify-content:center;
    padding:14px;border:2px dashed #dbe3f3;border-radius:16px;background:#f8fbff;margin-top:6px;text-align:center
  }
  .money{font-size:36px;font-weight:900;letter-spacing:.2px}
  .mutelist{display:grid;gap:6px;font-size:13px;color:#475569}
  .cta{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .bigbtn{
    flex:1 0 180px;padding:14px 16px;border-radius:16px;border:none;cursor:pointer;font-size:16px;font-weight:800;color:#fff
  }
  .primary{background:var(--ok)}
  .secondary{background:var(--dk-red)}
  .ghost{background:#e7ecff;color:#102a83}
  .right{display:flex;gap:10px;align-items:center}
  .badge{padding:4px 10px;background:#fff;color:#E11F2A;border:1px solid rgba(0,0,0,.06);border-radius:999px;font-size:12px;font-weight:800}
  .footnote{margin-top:16px;font-size:12px;color:#64748b}
  .kdvbar .pill{flex:1 0 120px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand"><img src="logo.png" alt="Demir Kırtasiye logosu" /></div>
      <div>
        <h1>Premium Ürün Fiyatlandırma Hesaplayıcı</h1>
        <div class="sub">KDV dâhil ya da KDV hariç girişle çalışır. Hangisini doldurursan oradan yürür.</div>
      </div>
    </div>

    <div class="card">
      <div class="grid">
        <div class="field">
          <label>Geliş Fiyatı (KDV <strong>Hariç</strong>) — ₺</label>
          <input id="gelisEx" type="text" inputmode="decimal" placeholder="Örn: 34,90 veya 34.90" />
        </div>

        <div class="field">
          <label>Geliş Fiyatı (KDV <strong>Dâhil</strong>) — ₺ <span class="badge">Opsiyon</span></label>
          <input id="gelisInc" type="text" inputmode="decimal" placeholder="Örn: 41,88 veya 41.88" />
        </div>

        <div class="field">
          <label>İskonto Oranı %</label>
          <input id="iskonto" type="text" inputmode="decimal" placeholder="Örn: 5 veya 5,5" />
        </div>

        <div class="field">
          <label>KDV Oranı %</label>
          <div class="pillbar kdvbar">
            <button class="pill" data-kdv="0">KDV %0</button>
            <button class="pill" data-kdv="10">KDV %10</button>
            <button class="pill active" data-kdv="20">KDV %20</button>
          </div>
        </div>
      </div>

      <div class="row-3" style="margin-top:10px">
        <div class="field" style="grid-column:1/-1">
          <label>Kâr Oranı % (tek dokunuşla seç)</label>
          <div class="pillbar">
            <button class="pill" data-kar="20">+%20</button>
            <button class="pill" data-kar="30">+%30</button>
            <button class="pill" data-kar="40">+%40</button>
            <button class="pill" data-kar="50">+%50</button>
            <button class="pill" data-kar="60">+%60</button>
            <button class="pill" data-kar="80">+%80</button>
            <button class="pill alt" data-kar="100">+%100</button>
          </div>
        </div>
        <div class="field">
          <label>Manuel Kâr Oranı %</label>
          <input id="kar" type="text" inputmode="decimal" placeholder="Örn: 33 veya 33,5" />
        </div>
        <div class="field right" style="justify-content:space-between">
          <span class="hint">Her değişimde otomatik hesaplanır.</span>
          <button id="clr" class="bigbtn secondary" title="Formu temizle">Temizle</button>
        </div>
      </div>

      <div class="result" id="res">
        <div class="money" id="satis">₺0,00</div>
        <div class="mutelist" id="mini"></div>
        <div class="cta">
          <button id="copy" class="bigbtn primary">Fiyatı Kopyala</button>
          <button id="round" class="bigbtn ghost">.99’a Yuvarla</button>
        </div>
      </div>

      <div class="footnote">
        Yalnızca <strong>KDV dâhil geliş</strong> + <strong>Kâr</strong> girsen bile sonuç çıkar. 
        İstersen iskonto ekleyerek daha hassas hesaplayabilirsin.
      </div>
    </div>
  </div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const gelisEx  = $('gelisEx');
  const gelisInc = $('gelisInc');
  const iskonto  = $('iskonto');
  const kar      = $('kar');
  const satis    = $('satis');
  const mini     = $('mini');
  const copyBtn  = $('copy');
  const roundBtn = $('round');
  const clrBtn   = $('clr');
  let kdvRate = 0.20; // default %20

  document.querySelectorAll('[data-kdv]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('[data-kdv]').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      kdvRate = parseInt(btn.dataset.kdv,10)/100;
      compute();
    });
  });

  document.querySelectorAll('[data-kar]').forEach(b=>{
    b.addEventListener('click', ()=>{ kar.value = b.dataset.kar; compute(); });
  });

  [gelisEx, gelisInc, iskonto, kar].forEach(x=> x.addEventListener('input', compute));

  clrBtn.addEventListener('click', ()=>{
    [gelisEx, gelisInc, iskonto, kar].forEach(x=>x.value='');
    document.querySelectorAll('[data-kdv]').forEach(b=>b.classList.remove('active'));
    document.querySelector('[data-kdv="20"]').classList.add('active');
    kdvRate = 0.20;
    compute();
  });

  copyBtn.addEventListener('click', ()=>{
    const t = satis.textContent.replace(/[^\d.,]/g,'').replace(/\./g,'').replace(',','.');
    navigator.clipboard.writeText(t).then(()=>{
      copyBtn.textContent='Kopyalandı!';
      setTimeout(()=>copyBtn.textContent='Fiyatı Kopyala',1200);
    });
  });

  roundBtn.addEventListener('click', ()=>{
    const raw = parseFloatNumber(satis.dataset.raw||'0');
    if(!raw) return;
    const rounded = Math.floor(raw) + 0.99;
    setOutput(rounded);
  });

  function parsePercent(v, fallback=0){
    const n = parseFloatNumber(v);
    return isFinite(n) ? n/100 : fallback;
  }

  function parseFloatNumber(v){
    if(v===undefined || v===null) return NaN;
    const s = String(v).trim();
    if(!s) return NaN;
    const cleaned = s.replace(/[^\d.,-]/g,'');
    const lastComma = cleaned.lastIndexOf(',');
    const lastDot   = cleaned.lastIndexOf('.');
    let normalized = cleaned;
    if(lastComma>-1 && lastDot>-1){
      if(lastComma > lastDot){
        normalized = cleaned.replace(/\./g,'').replace(',', '.');
      }else{
        normalized = cleaned.replace(/,/g,'');
      }
    }else if(lastComma>-1){
      normalized = cleaned.replace(',', '.');
    }else{
      normalized = cleaned;
    }
    return parseFloat(normalized);
  }

  function tl(n){
    return n.toLocaleString('tr-TR',{style:'currency',currency:'TRY',minimumFractionDigits:2,maximumFractionDigits:2});
  }

  function setOutput(val, details){
    if(!isFinite(val) || val<=0){
      satis.textContent = '₺0,00';
      satis.dataset.raw = '0';
      mini.innerHTML = '';
      return;
    }
    satis.textContent = tl(val);
    satis.dataset.raw = String(val);
    if(details){
      mini.innerHTML = details.map(d=>`<div>• ${d}</div>`).join('');
    }
  }

  function compute(){
    const discRate = parsePercent(iskonto.value, 0);
    const profit   = parsePercent(kar.value, 0);

    let costEx = NaN;
    const vEx  = parseFloatNumber(gelisEx.value);
    const vInc = parseFloatNumber(gelisInc.value);

    if(isFinite(vEx) && vEx>0){
      costEx = vEx;
    } else if(isFinite(vInc) && vInc>0){
      costEx = vInc / (1+kdvRate);
    }

    if(!isFinite(costEx) || costEx<=0 || profit<0){
      setOutput(NaN);
      return;
    }

    const costAfterDisc = costEx * (1 - discRate);
    const sellEx = costAfterDisc * (1 + profit);
    const sellInc = sellEx * (1 + kdvRate);

    setOutput(sellInc, [
      `KDV hariç temel maliyet: ${tl(costEx)}`,
      (discRate>0? `İskonto sonrası: ${tl(costAfterDisc)} (−%${(discRate*100).toFixed(2)})` : `İskonto yok`),
      `Kâr oranı: %${(profit*100).toFixed(2)}`,
      `KDV oranı: %${(kdvRate*100)}`
    ]);
  }

  compute();
})();
</script>
</body>
</html>
